cd "/home/lee/Desktop/IaS-ViT/" && python3 -u test_quant.py
Namespace(model='deit_small', dataset='data/ImageNet', calib_batchsize=1024, val_batchsize=200, num_workers=8, device='cuda', print_freq=100, seed=0, w_bits=4, a_bits=4, w_cw=True, a_cw=False, iter=1000, warmup=0.2)
Building dataloader ...
Building model ...
quantization settings: {'n_bits': 4, 'channel_wise': True} | {'n_bits': 4, 'channel_wise': False}

Stage One, Q-Act, FP-W
Init quantization parameters of act
Start optimization
Reconstruction for layer proj
Total loss:     0.000   count=500
Total loss:     0.000   count=1000
Reconstruction for block 0
Total loss:     8.494   count=500
Total loss:     8.224   count=1000
Reconstruction for block 1
Total loss:     2.827   count=500
Total loss:     2.709   count=1000
Reconstruction for block 2
Total loss:     2.529   count=500
Total loss:     2.470   count=1000
Reconstruction for block 3
Total loss:     2.347   count=500
Total loss:     2.295   count=1000
Reconstruction for block 4
Total loss:     2.574   count=500
Total loss:     2.513   count=1000
Reconstruction for block 5
Total loss:     3.401   count=500
Total loss:     3.367   count=1000
Reconstruction for block 6
Total loss:     4.834   count=500
Total loss:     4.707   count=1000
Reconstruction for block 7
Total loss:     4.123   count=500
Total loss:     4.202   count=1000
Reconstruction for block 8
Total loss:     5.190   count=500
Total loss:     4.939   count=1000
Reconstruction for block 9
Total loss:     4.555   count=500
Total loss:     4.686   count=1000
Reconstruction for block 10
Total loss:     3.749   count=500
Total loss:     3.615   count=1000
Reconstruction for block 11
Total loss:     4.277   count=500
Total loss:     4.121   count=1000
Reconstruction for layer head
Total loss:     8.923   count=500
Total loss:     8.789   count=1000
Acc after Stage One: 
Test: [0/250]   Time 2.815 (2.815)      Loss 0.6489 (0.6489)    Prec@1 84.000 (84.000)      Prec@5 98.000 (98.000)
Test: [100/250] Time 0.403 (0.430)      Loss 1.2804 (0.8213)    Prec@1 68.500 (81.228)      Prec@5 90.500 (95.842)
Test: [200/250] Time 0.404 (0.416)      Loss 0.4802 (1.0117)    Prec@1 89.500 (76.734)      Prec@5 97.500 (93.415)
 * Prec@1 76.196 Prec@5 93.256 Time 103.495

Stage Two, reparameterization
Stage Three, Q-Act, Q-W
Init quantization parameters of weight
re optimization
Reconstruction for layer proj
Total loss:     3.232   count=500
Total loss:     0.507   count=1000
Reconstruction for block 0
Total loss:     10.487  count=500
Total loss:     8.712   count=1000
Reconstruction for block 1
Total loss:     10.962  count=500
Total loss:     10.367  count=1000
Reconstruction for block 2
Total loss:     15.194  count=500
Total loss:     14.200  count=1000
Reconstruction for block 3
Total loss:     20.577  count=500
Total loss:     21.012  count=1000
Reconstruction for block 4
Total loss:     35.073  count=500
Total loss:     34.402  count=1000
Reconstruction for block 5
Total loss:     61.826  count=500
Total loss:     61.918  count=1000
Reconstruction for block 6
Total loss:     96.716  count=500
Total loss:     97.051  count=1000
Reconstruction for block 7
Total loss:     129.870         count=500
Total loss:     126.886         count=1000
Reconstruction for block 8
Total loss:     161.094         count=500
Total loss:     165.908         count=1000
Reconstruction for block 9
Total loss:     196.304         count=500
Total loss:     203.688         count=1000
Reconstruction for block 10
Total loss:     203.329         count=500
Total loss:     203.258         count=1000
Reconstruction for block 11
Total loss:     201.359         count=500
Total loss:     202.701         count=1000
Reconstruction for layer head
Total loss:     183.864         count=500
Total loss:     179.341         count=1000
Acc after re optimization
Test: [0/250]   Time 2.659 (2.659)      Loss 0.7197 (0.7197)    Prec@1 85.500 (85.500)Prec@5 99.000 (99.000)
Test: [100/250] Time 0.409 (0.431)      Loss 1.3742 (0.9968)    Prec@1 66.500 (80.262)Prec@5 91.500 (95.505)
Test: [200/250] Time 0.409 (0.420)      Loss 0.6159 (1.1785)    Prec@1 92.000 (76.134)Prec@5 96.500 (93.179)
 * Prec@1 75.490 Prec@5 93.026 Time 104.492